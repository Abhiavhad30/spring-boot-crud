<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Review Your Order</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">

<h2>Review Your Order</h2>

<div th:if="${order != null}">
    <p><strong>Order ID:</strong> <span th:text="${order.id}"></span></p>
    <p><strong>Product:</strong> <span th:text="${order.productName}"></span></p>
    <p><strong>Quantity:</strong> <span th:text="${order.quantity}"></span></p>
    <p><strong>Total Price:</strong> â‚¹<span th:text="${order.price}"></span></p>
</div>

<button id="payWithPaypalBtn" class="btn btn-success mt-3">ðŸ’³ Pay with PayPal</button>

<script th:inline="javascript">
    /*<![CDATA[*/
    document.getElementById('payWithPaypalBtn').addEventListener('click', async () => {
        const orderId = /*[[${order.id}]]*/ '';
        try {
            const response = await fetch('/orders/' + orderId + '/pay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
            });
            const data = await response.json();
            if (data.approval_url) {
                window.location.href = data.approval_url;
            } else {
                alert('Failed to initiate PayPal payment. Please try again.');
            }
        } catch (error) {
            alert('Error initiating payment: ' + error.message);
        }
    });
    /*]]>*/
</script>

</body>
</html>
